<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>noit o' mnain worb</title>
  <style>
#canvas { border: 1px solid blue; }
#canvas_viewport {
    width: 420px; height: 420px; overflow: scroll; border: 1px solid black;
    display: inline-block;
}
#load_indicator { border: 1px solid purple; }
  </style>
</head>
<body>

<h1>noit o' mnain worb</h1>

<div id="control_panel"></div>

<div>
  configuration: <select id="select_source"></select>
  <span id="load_indicator">
    load indicator
  </span>
</div>

<div id="canvas_viewport">
  <canvas id="canvas" width="400" height="400">
    Your browser doesn't support displaying an HTML5 canvas.
  </canvas>
</div>

<textarea id="editor" rows="25" cols="40"></textarea>

</body>
<script src="../src/yoob/controller.js"></script>
<script src="../src/yoob/playfield.js"></script>
<script src="../src/yoob/playfield-canvas-view.js"></script>
<script src="../src/yoob/preset-manager.js"></script>
<script src="../src/yoob/source-manager.js"></script>
<script src="../src/worb.js"></script>
<script src="../../../eg/index.js"></script>
<script>
  var loadIndicator = document.getElementById('load_indicator');
  var controlPanel = document.getElementById('control_panel');
  var display = document.getElementById('canvas_viewport');

  var v = new yoob.PlayfieldCanvasView().init({
      canvas: document.getElementById('canvas')
  });
  v.setCellDimensions(16, 16);

  var controller = (new WorbController()).init({
      panelContainer: controlPanel,
      view: v
  });

  var loadLevel = 0;
  controller.onstep = function(underLoad) {
      if (underLoad) loadLevel += 60;
      loadLevel -= 10;
      if (loadLevel < 0) loadLevel = 0;
      if (loadLevel > 255) loadLevel = 255;
      var l = 255 - loadLevel;
      loadIndicator.style.background = "rgba(255, " + l + "," + l + ",1.0)";
  };

  var sourceManager = (new yoob.SourceManager()).init({
      panelContainer: controlPanel,
      editor: document.getElementById('editor'),
      hideDuringEdit: [display],
      disableDuringEdit: [controller.panel],
      storageKey: 'worb.js',
      onDone: function() {
          controller.setResetState(this.getEditorText());
          controller.clickReset();
      }
  });

  var presetManager = (new yoob.PresetManager()).init({
    selectElem: document.getElementById('select_source'),
  });
  function makeCallback(sourceText) {
    return function(id) {
      sourceManager.loadSource(sourceText);
    }
  }
  for (var i = 0; i < examplePrograms.length; i++) {
    presetManager.add(examplePrograms[i][0], makeCallback(examplePrograms[i][1]));
  }
  presetManager.select(examplePrograms[0][0]);
</script>
