<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>noit o' mnain worb</title>
  <style>
#canvas { border: 1px solid blue; }
#canvas_viewport {
    width: 420px; height: 420px; overflow: scroll; border: 1px solid black;
    display: inline-block;
}
# load_indicator { border: 1px solid purple; }
.initial_configuration { display: none; }
  </style>
</head>
<body>

<h1>noit o' mnain worb
<button id="load">Load</button>
<button id="start">Start</button>
<button id="stop">Stop</button>
</h1>

<div>
  <span class="control-container">
    configuration:
    <span id="select_configuration_div">
      <select id="select_configuration">
        <option>(select one...)</option>
        <option>freefill</option>
        <option>magnetic_field</option>
        <option>theory_of_time</option>
        <option>slow_loop</option>
        <option>fast_loop</option>
        <option>pressure</option>
        <option>transistor</option>
        <option>or_gate</option>
        <option>subtraction</option>
        <option>division</option>
        <option>heater</option>
      </select>
    </span>
  </span>
  <span id="load_indicator">
    load indicator
  </span>
</div>

<div id="canvas_viewport">
  <canvas id="canvas" width="400" height="400">
    Your browser doesn't support displaying an HTML5 canvas.
  </canvas>
</div>

<textarea id="configuration" rows="25" cols="40">
</textarea>

<div class="initial_configuration" id="freefill"
>######################
#                    #
#                    #
#                    #
#                    #
#                    #
#         +          #
#                    #
#                    #
#                    #
#                    #
######################
</div>

<div class="initial_configuration" id="theory_of_time"
>######################
#..........          #
#..........          #
#..........          #
#..........          #
#..........          #
#..........          #
#..........          #
#..........          #
#..........          #
#..........          #
######################
</div>

<div class="initial_configuration" id="slow_loop"
>#####################
#        (          #
# ################# #
# #               # #
# #               #.#
# #               # #
# ################# #
#         )         #
#####################
</div>

<div class="initial_configuration" id="fast_loop"
>#######
# ( ( #
#v###^#
# ).) #
#######
</div>

<div class="initial_configuration" id="magnetic_field"
>######################
#                    #
#                    #
#                    #
#        ---         #
#        ---         #
#        +++         #
#        +++         #
#                    #
#                    #
#                    #
######################
</div>

<div class="initial_configuration" id="pressure"
>#######################
#..........)          #
#######################
</div>

<div class="initial_configuration" id="transistor"
>        ###
###     #+#
#+#     # #
# #######v#
#       ( #
###     ( #
  #     ( #
  #######v#
        # #
        #!#
        #-#
        ###
</div>

<div class="initial_configuration" id="or_gate"
>#####         #####
#   ###########   #
# . )         ( . #
#   #####v#####   #
#####   #  ########
        #       )!#
        #v#########
        # #
        ###
</div>

<div class="initial_configuration" id="subtraction"
>###############
#.............#
#######v#######
      #       #
      #########
</div>

<div class="initial_configuration" id="division"
>############
#..........#
#######v####
      #    #
      #v####
      #    #
      #v####
      #    #
      #v####
      #    #
      ######
</div>

<div class="initial_configuration" id="heater"
>     #########
     #! ! ! !#
###### ! ! ! ######
#+    ! ! ! !    -#
###### ! ! ! ######
     #! ! ! !#
     #########
</div>

</body>
<script src="../src/yoob/playfield.js"></script>
<script src="../src/worb.js"></script>
<script>
  var canvas = document.getElementById('canvas');
  var cfg = document.getElementById('configuration');
  var loadIndicator = document.getElementById('load_indicator');

  var worb = new NoitOMnainWorb();
  var loadLevel = 0;

  worb.init(canvas);
  worb.onstep = function(underLoad) {
      if (underLoad) loadLevel += 60;
      loadLevel -= 10;
      if (loadLevel < 0) loadLevel = 0;
      if (loadLevel > 255) loadLevel = 255;
      var l = 255-loadLevel;
      loadIndicator.style.background = "rgba(255, " + l + "," + l + ",1.0)";
  };
  document.getElementById('load').onclick = function() {
      worb.load(cfg);
  };
  document.getElementById('start').onclick = function() {
      worb.start();
  };
  document.getElementById('stop').onclick = function() {
      worb.stop();
  };
  document.getElementById('select_configuration').onchange = function() {
      var initcfg = document.getElementById(this.options[this.selectedIndex].value);
      var text = initcfg.innerHTML;
      text = text.replace(/\(/g, '<');
      text = text.replace(/\)/g, '>');
      cfg.value = text;
      worb.load(cfg);
  };
</script>
